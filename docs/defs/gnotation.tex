% TikZ setup for the RoboCert graphical notation.
% 
% This can likely be removed if and when we bring Sirius (or any other
% specifier) up.

\newcommand{\gkeywordfont}{\sffamily\bfseries}
\newcommand{\gkeyword}[1]{{\gkeywordfont #1}}
\newcommand{\osigil}{\gkeyword{op}}
\newcommand{\esigil}{\gkeyword{event}}

% Shading used for various parts of the graphical notation.
% Colour to be used very sparingly here.
\colorlet{gshading}{ocre!20}

\tikzset{
  actor/.style={draw, rectangle, minimum width=6em, align=center, minimum height=1.7em, fill={gshading}},
  world/.style={actor, font={\small\gkeyword{world}}},
  target/.style={actor},
  rcmodule/.style={target, font={\small\gkeyword{module}\;}},
  lifeline/.style={dashed, thick},
  deadline/.style={solid, font={\footnotesize}},
  deadlinespan/.style={latex-latex},
  diagram/.style={row sep=2em, column sep=5em},
  arrow/.style={->, thick},
  oarrow/.style={arrow, font={\scriptsize\osigil\;}},
  earrow/.style={arrow, font={\scriptsize\esigil\;}},
  final/.style={dotted, thick, font={\scriptsize\gkeywordfont}, "end"},
  wait/.style={dotted, thick, font={\scriptsize}},
  cfbox/.style={draw},
  cfheader/.style={chamfered rectangle, draw, font={\small}, fill={gshading}, chamfered rectangle corners=south east, inner sep=0.2em},
  gap/.style={circle, inner sep=0, minimum size=6pt, fill=black}
}
\newcommand{\gsecaption}{
  \captionsetup{
    labelformat=empty,
    font={small,sf}
  }
  \caption{Graphical syntax example \todo{draft}}}

% Gap notation
% #1: location node
% #2: set expression
\newcommand{\ggapout}[2]{
  \node[gap,"\scriptsize\(#2\)" above right] at (#1) {};
}
\newcommand{\ggapin}[2]{
  \node[gap,"\scriptsize\(#2\)" above left] at (#1) {};
}
\newcommand{\gdiff}[2]{#1\setminus#2}
\newcommand{\guniverse}{\ast}
\newcommand{\gextset}[1]{\{#1\}}
\newcommand{\gemptyset}{\gextset{}}
\newcommand{\grefset}[1]{\text{#1}}

% Combined fragment
% #1: top-left
% #2: top-right
% #3: bottom-left
% #4: bottom-right
% #5: pad factor
% #6: fragment header
% #7: node name
\newcommand{\gcfrag}[7]{
  \node[cfbox, fit=(#1) (#2) (#3) (#4), inner sep=#5] (#7) {};
  \node[cfheader,anchor=north west] at (#7.north west) {#6};
}

% Sequence diagram
% #1: top-left (module)
% #2: top-right (world)
% #3: bottom-left
% #4: bottom-right
% #5: sequence name
\newcommand{\gseq}[5]{\gcfrag{#1}{#2}{#3}{#4}{2em}{\gkeyword{sd} #5}{sd#5}}

% Loop
% #1: top-left
% #2: top-right
% #3: bottom-left
% #4: bottom-right
% #5: loop name
% #6: loop header
\newcommand{\gloop}[6]{\gcfrag{#1}{#2}{#3}{#4}{1em}{\gkeyword{loop}#6 #5}{loop#5}}

% Loop bounds
% These follow UML for now.
\newcommand{\gloopinfinite}{}
\newcommand{\gloopdefinite}[1]{(#1)}
\newcommand{\glooprange}[2]{(#1, #2)}
\newcommand{\glooplower}[1]{\glooprange{#1}{\(\ast\)}}

% #1: LHS
% #2: RHS
% #3: label
\newcommand{\goperation}[3]{\draw (#1) edge[oarrow,"#3"] (#2);}

% #1: LHS
% #2: RHS
\newcommand{\gfinal}[2]{\draw (#1) edge[final] (#2);}

% #1: LHS
% #2: RHS
% #3: units expression
\newcommand{\gwait}[3]{\draw (#1) edge[wait,"\gkeyword{wait}(#3)"] (#2);}

\newcommand{\gdeadlineoffset}{2em}
% #1: World top
% #2: World bottom
% #3: Time units
\newcommand{\gdeadline}[3]{
  \draw (#1) edge[deadline] ($(#1) + (\gdeadlineoffset, 0)$);
  \draw ($(#1) + (\gdeadlineoffset, 0)$) edge[deadlinespan,"#3"] ($(#2) + (\gdeadlineoffset, 0)$);
  \draw ($(#2) + (\gdeadlineoffset, 0)$) edge[deadline] (#2);
}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../robocert"
%%% End:
