%!TEX root=./robocert.tex

% Target language colouration
\newcommand{\tlang}[1]{\textcolor{gray}{\boxed{#1}}}
% Object language colouration (nested inside target language)
\newcommand{\olang}[1]{\boxed{\textcolor{black}{#1}}}

\newcommand{\tockcsp}{\emph{tock}-CSP}
\newcommand{\cspm}{CSP\(_\text{M}\)}

\newcommand{\defeq}{\mathbin{\overset{\text{def}}=}}
% CSP operators
\newcommand{\interrupt}{\mathbin{\triangle}}
\newcommand{\cspnsop}{\mathbin{\!:\!:\!}}
% CSP keywords/processes
\newcommand{\cspkw}[1]{\operatorname{\mathbf{#1}}}
\newcommand{\runproc}[1]{\cspkw{Run}\left(#1\right)}
\newcommand{\events}{\cspkw{Events}}

%
% Metasyntactic variables
%
\newcommand{\apkg}{P}
\newcommand{\acsp}{f}
\newcommand{\anarrow}{a}
\newcommand{\anevent}{e}
\newcommand{\agap}{g}
\newcommand{\amspec}{m}
\newcommand{\amsgset}{M}
\newcommand{\aumsgset}{\amsgset_{\universe}}
\newcommand{\anemsgset}{\amsgset_{e}}
\newcommand{\aloop}{l}
\newcommand{\anop}{o}
\newcommand{\aseq}{\sigma}
\newcommand{\asseq}{q}
\newcommand{\astep}{s}
\newcommand{\atarget}{t}
\newcommand{\aninst}{\phi}
\newcommand{\aworld}{w}
\newcommand{\anaction}{\alpha}
\newcommand{\anexpr}{x}
\newcommand{\avar}{v}
% Assertions
\newcommand{\anasst}{\alpha}
\newcommand{\asasst}{\alpha_s}
\newcommand{\amodel}{\mathcal{M}}

\newcommand{\sema}[2]{\llbracket #1 \rrbracket^{\mathsf{#2}}}
\newcommand{\pkgsema}[1]{\sema{#1}{pkg}}
\newcommand{\cspsema}[1]{\sema{#1}{csp}}
\newcommand{\stepsema}[1]{\sema{#1}{step}}
\newcommand{\exprsema}[2]{\sema{#1}{expr}_{(#2)}}
\newcommand{\gapsema}[2]{\sema{#1}{gap}_{(#2)}}
\newcommand{\actsema}[1]{\sema{#1}{act}}
\newcommand{\mspecsema}[1]{\sema{#1}{mspec}}
\newcommand{\loopsema}[1]{\sema{#1}{loop}}
\newcommand{\msgsetsema}[1]{\sema{#1}{mset}}
\newcommand{\seqsema}[1]{\sema{#1}{seq}}
\newcommand{\sseqsema}[1]{\sema{#1}{sseq}}
\newcommand{\asstsema}[1]{\sema{#1}{asst}}

\newcommand{\targetsema}[2]{\sema{#1}{target}_{(#2)}}

\newcommand{\ctargetRef}[1]{\funcname{ctargetRef}(#1)}
\newcommand{\otargetRef}[2]{\funcname{otargetRef}(#1, #2)}
\newcommand{\targetRef}[2]{\funcname{targetRef}(#1, #2)}

\newcommand{\funcname}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\eventsOf}[1]{\funcname{events}(#1)}
\newcommand{\seqnameOf}[1]{\funcname{seqName}(#1)}
\newcommand{\ctargetnameOf}[1]{\funcname{ctargetName}(#1)}
\newcommand{\otargetnameOf}[1]{\funcname{otargetName}(#1)}

\newcommand{\field}[2]{#1.\funcname{#2}}

This chapter formally captures the semantics of \langname{} in terms of its
target languages:

\begin{itemize}
\item
	\tockcsp~(\cref{sec:semantics-tockcsp});
\item
	\todo{PRISM};
\item
	\todo{Isabelle/UTP?}.
\end{itemize}

Each semantics captures \massertion s as the top-level definition, with all
objects reachable from the assertions translated in-line.  As a
consequence, we do not capture organisational details such as \mrapackage s,
or any distinction between references to objects and their definitions.

\section{How to read this section}

\begin{table}
	\centering

	\begin{tabular}{p{2em}p{11em}}
	\toprule
	\thead{Var.} & \thead{Type}
	\\
	\midrule
	\multicolumn{2}{l}{\tsubhead{Packages (\cref{sec:metamodel-top})}}
	\\
	\(\apkg\) & \mrapackage
	\\
	\(\acsp\) & \mcspfragment
	\\
	\midrule
	\multicolumn{2}{l}{\tsubhead{Sequences (\cref{sec:metamodel-sequences})}}
	\\
	\(\aseq\) & \msequence
	\\
	\(\asseq\) & \msubsequence
	\\
	\(\astep\) & \msequencestep
	\\
	\(\agap\) & \msequencegap
	\\
	\midrule
	\multicolumn{2}{l}{\tsubhead{Actions (\cref{sec:metamodel-actions})}}
	\\
	\(\anaction\) & \msequenceaction
	\\
	\(\anarrow\) & \marrowaction
	\\
	\(\aloop\) & \mloopaction
	\\
	\(\bot\) & \mfinalaction
	\\
	\\
	\bottomrule
	\end{tabular}
	\begin{tabular}{p{2em}p{11em}}
	\toprule
	\thead{Var.} & \thead{Type}
	\\
	\midrule
	\multicolumn{2}{l}{\tsubhead{Messages (\cref{sec:metamodel-messages})}}
	\\
	\(\amspec\) & \mmessagespec
	\\
	\(\amsgset\) & \mgapmessageset
	\\
	\(\aumsgset\) & \muniversegapmessageset
	\\
	\(\anemsgset\) & \mextensionalgapmessageset
	\\
	\midrule
	\multicolumn{2}{l}{\tsubhead{Actors (\cref{sec:metamodel-actors})}}
	\\
	\(\atarget\) & \mtarget
	\\
	\(\aworld\) & \mworld
	\\
	\(\aninst\) & \mtargetinstantiation
	\\
	\(\avar\) & \mvariable
	\\
	\(\anexpr\) & \mexpression
	\\
	\midrule
	\multicolumn{2}{l}{\tsubhead{Assertions (\cref{sec:metamodel-assertions})}}
	\\
	\(\anasst\) & \massertion
	\\
	\(\asasst\) & \msequenceassertion
	\\
	\(\amodel\) & \mcspmodel	
	\\
	\bottomrule
	\end{tabular}

	\caption{Metasyntactic variables.}
	\label{tab:metasyntactic-variables}
\end{table}

The semantics treatments in this section take the form of rewrite rules from
the abstract syntax in \cref{cha:metamodel} to some object language (for
instance, \tockcsp).
For conciseness, we use a meta-language based on the Z notation.
\todo{is this ok?  does it need better explanation?}
We also use the following notational conventions \todo{may need tweaking}:

\begin{itemize}
\item
	\tlang{\text{boxed shaded text}} denotes a construct from the object
	language; outside such text, or \tlang{\olang{\text{inside nested boxes}}},
	assume use of the meta-language;
\item
	\(\sema{-}{name}\) denotes a main semantic rule;
\item
	\(\funcname{name}()\) denotes auxiliary semantic functions;
\item
	\(\field{x}{name}\) denotes a field of the metamodel object \(x\);
\item
	variables in the meta-language have an implicit metamodel type
	corresponding to one of the metasyntactic variables in
	\cref{tab:metasyntactic-variables}.
\end{itemize}

\section{\tockcsp{} semantics}\label{sec:semantics-tockcsp}
\input{semantics/tockcsp}
