%!TEX root=./robocert.tex

% Target language colouration
\newcommand{\tlang}[1]{\textcolor{TColor}{\boxed{#1}}}
% Object language colouration (nested inside target language)
\newcommand{\olang}[1]{\boxed{\textcolor{ZedColor}{#1}}}

\newcommand{\tockcsp}{\emph{tock}-CSP}
\newcommand{\cspm}{CSP\(_\text{M}\)}

\newcommand{\defeq}{\mathbin{\overset{\text{def}}=}}
% CSP operators
\newcommand{\interrupt}{\mathbin{\triangle}}
\newcommand{\cspnsop}{\mathbin{\!:\!:\!}}
% CSP keywords/processes
\newcommand{\cspkw}[1]{\operatorname{\mathbf{#1}}}
\newcommand{\runproc}[1]{\cspkw{Run}\left(#1\right)}
\newcommand{\events}{\cspkw{Events}}

%
% Metasyntactic variables
%
\newcommand{\acontext}{c}
\newcommand{\anexpr}{e}
\newcommand{\avar}{v}
% Top-level
\newcommand{\apkg}{P}
\newcommand{\acsp}{f}
% Sequences
\newcommand{\aseq}{\sigma}
\newcommand{\asseq}{q}
% Steps
\newcommand{\astep}{s}
\newcommand{\anastep}{s_a}
\newcommand{\adeadline}{d}
\newcommand{\aloop}{l}
\newcommand{\agap}{g}
% Actions
\newcommand{\anaction}{a}
\newcommand{\anarrow}{\rho}
\newcommand{\await}{w}
% Messages
\newcommand{\amspec}{m}
\newcommand{\amsgset}{M}
\newcommand{\aumsgset}{\amsgset_{\universe}}
\newcommand{\anemsgset}{\amsgset_{e}}
\newcommand{\armsgset}{\amsgset_{r}}
\newcommand{\anevent}{\epsilon}
\newcommand{\anop}{o}
% - Arguments
\newcommand{\anarg}{x}
\newcommand{\anexprarg}{\anarg_\anexpr}
\newcommand{\arestarg}{\anarg_r}
\newcommand{\anarglist}{\mathbf{x}}
% Actors
\newcommand{\atarget}{t}
\newcommand{\aninst}{\phi}
\newcommand{\aworld}{w}
% Assertions
\newcommand{\anasst}{\alpha}
\newcommand{\asasst}{\alpha_s}
\newcommand{\amodel}{\mathcal{M}}

% External semantics
\newcommand{\exprsema}[2]{\sema{#1}{expr}_{(#2)}}

\newcommand{\sema}[2]{\llbracket #1 \rrbracket^{\mathsf{#2}}}
\newcommand{\pkgsema}[1]{\sema{#1}{pkg}}
\newcommand{\cspsema}[1]{\sema{#1}{csp}}
\newcommand{\stepsema}[1]{\sema{#1}{step}}
\newcommand{\gapsema}[2]{\sema{#1}{gap}_{(#2)}}
\newcommand{\actsema}[1]{\sema{#1}{act}}
\newcommand{\mspecsema}[2]{\sema{#1}{mspec}_{\text{#2}}}
\newcommand{\pmspecsema}[1]{\mspecsema{#1}{prefix}}
\newcommand{\emspecsema}[1]{\mspecsema{#1}{events}}
\newcommand{\arglistsema}[2]{\sema{#1}{args}_{(#2)}}
\newcommand{\loopsema}[1]{\sema{#1}{loop}}
\newcommand{\msgsetsema}[1]{\sema{#1}{mset}}
\newcommand{\seqsema}[1]{\sema{#1}{seq}}
\newcommand{\sseqsema}[1]{\sema{#1}{sseq}}
\newcommand{\asstsema}[1]{\sema{#1}{asst}}

\newcommand{\targetsema}[2]{\sema{#1}{target}_{(#2)}}

\newcommand{\funcname}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\eventsOf}[1]{\funcname{events}(#1)}
\newcommand{\seqnameOf}[1]{\funcname{seqName}(#1)}
\newcommand{\ctargetnameOf}[1]{\funcname{ctargetName}(#1)}
\newcommand{\otargetnameOf}[1]{\funcname{otargetName}(#1)}

\newcommand{\field}[2]{#1.\funcname{#2}}

This chapter formally captures the semantics of \langname{} in terms of its
target languages:

\begin{itemize}
\item
	\tockcsp~(\cref{sec:semantics-tockcsp});
\item
	\todo{PRISM};
\item
	\todo{Isabelle/UTP?}.
\end{itemize}

Each semantics captures \massertion s as the top-level definition, with all
objects reachable from the assertions translated in-line.  As a
consequence, we do not capture organisational details such as \mrapackage s,
or any distinction between references to objects and their definitions.

\section{How to read this section}

\begin{table}
  \centering

  \begin{tabular}{p{1.3em}p{9em}}
    \toprule
    \thead{Var.}
    & \thead{Type}
    \\
    \midrule
    \multicolumn{2}{l}{\tsubhead{\robochart{} imports}}
    \\
    \(\avar\) & \mvariable
    \\
    \(\anexpr\) & \mexpression
    \\
    \bottomrule
  \end{tabular}
  \begin{tabular}{p{1.3em}p{9em}}
    \toprule
    \thead{Var.}
    & \thead{Type}
    \\
    \midrule
    \multicolumn{2}{l}{\tsubhead{Packages (\cref{sec:metamodel-top})}}
    \\
    \(\apkg\) & \mrapackage
    \\
    \(\acsp\) & \mcspfragment
    \\
    \midrule
    \multicolumn{2}{l}{\tsubhead{Sequences (\cref{sec:metamodel-sequences})}}
    \\
    \(\aseq\) & \msequence
    \\
    \(\asseq\) & \msubsequence
    \\
    \midrule
    \multicolumn{2}{l}{\tsubhead{Steps (\cref{sec:metamodel-steps})}}
    \\
    \(\astep\) & \msequencestep
    \\
    \(\anastep\) & \mactionstep                 
    \\
    \(\agap\) & \msequencegap
    \\
    \(\adeadline\) & \mdeadlinestep
    \\
    \(\aloop\) & \mloopstep
    \\
    \midrule
    \multicolumn{2}{l}{\tsubhead{Actions (\cref{sec:metamodel-actions})}}
    \\
    \(\anaction\) & \msequenceaction
    \\
    \(\anarrow\) & \marrowaction
    \\
    \(\await\) & \mwaitaction
    \\
    \(\bot\) & \mfinalaction
    \\
    \\
    \bottomrule
  \end{tabular}
  \begin{tabular}{p{1.3em}p{9em}}
    \toprule
    \thead{Var.}
    & \thead{Type}
    \\
    \midrule
    \multicolumn{2}{l}{\tsubhead{Messages (\cref{sec:metamodel-messages})}}
    \\
    \(\amspec\) & \mmessagespec
    \\
    \(\amsgset\) & \mmessageset
    \\
    \(\aumsgset\) & \muniversemessageset
    \\
    \(\anemsgset\) & \mextensionalmessageset
    \\
    \(\armsgset\) & \mrefmessageset
    \\
    \midrule
    \multicolumn{2}{l}{\tsubhead{Arguments}}
    \\
    \(\anarg\) & \margument
    \\
    \(\anexprarg\) & \mexpressionargument
    \\
    \(\arestarg\) & \mrestargument
    \\
    \midrule
    \multicolumn{2}{l}{\tsubhead{Actors (\cref{sec:metamodel-actors})}}
    \\
    \(\atarget\) & \mtarget
    \\
    \(\aworld\) & \mworld
    \\
    \(\aninst\) & \mtargetinstantiation
    \\
    \midrule
    \multicolumn{2}{l}{\tsubhead{Assertions (\cref{sec:metamodel-assertions})}}
    \\
    \(\anasst\) & \massertion
    \\
    \(\asasst\) & \msequenceassertion
    \\
    \(\amodel\) & \mcspmodel	
    \\
    \bottomrule
  \end{tabular}
  
  \caption{Metasyntactic variables.}
  \label{tab:metasyntactic-variables}
\end{table}

The semantics treatments in this section take the form of rewrite rules from
the abstract syntax in \cref{cha:metamodel} to some object language (for
instance, \tockcsp).
For conciseness, we use a meta-language based on the Z notation.
We also use the following notational conventions:

\begin{itemize}
\item
	\(\sema{-}{name}\) denotes a main semantic rule;
\item
	\(\funcname{name}()\) denotes auxiliary semantic functions;
\item
	\(\field{x}{name}\) denotes a field of the metamodel object \(x\);
\item
	\tlang{\text{boxed shaded text}} denotes a construct from the object
	language; outside such text, or \tlang{\olang{\text{inside nested boxes}}},
	assume use of the meta-language.  For example, consider the \tockcsp{}
	construct:
	\[\tlang{
		\runproc{\olang{\gapsema{\field{\astep}{gap}}{\field{\astep}{action}}}}
		\interrupt \olang{\actsema{\field{\astep}{action}}}
	}\]
	Here, \(\runproc{}\) and \(\interrupt\) are part of \tockcsp, while
	\(\actsema{\field{\astep}{action}}\) is an semantic operation on the
	\langname{} metamodel.
\item
	variables in the meta-language have an implicit metamodel type
	corresponding to one of the metasyntactic variables in
	\cref{tab:metasyntactic-variables}.
\end{itemize}

\section{Dependencies on the \robochart{} semantics}

\newcommand{\targetProcess}[1]{\ensuremath{\funcname{targetProcess}\left(#1\right)}}
\newcommand{\targetParams}[1]{\ensuremath{\funcname{targetParams}\left(#1\right)}}
\newcommand{\constName}[1]{\ensuremath{\funcname{constName}\left(#1\right)}}

\todo{this may need to move to the \tockcsp{} section eventually}

Each semantics treatment in this section assumes the existence of a compatible
semantics over \robochart.  Specifically, we assume the following rules and
functions are available, or can be derived, from such a semantics:

\begin{itemize}
\item
	let \targetProcess{-} map a target to the parametric
	process exposed by the relevant \tockcsp{} semantics (for instance,
	we delegate to the \robochart{} semantics for the underlying
	\mrcmodule{} of a \mrcmoduletarget);
	\todo{doesn't account for the ID parameter in certain target
	processes};
\item
	let \targetParams{-} map a target to the sequence of
	constants in its parameterisation;
\item
	let \constName{-} map a constant to its name in the \robochart{}
	instantiations file;
\item
	let \(\exprsema{\anexpr}{\acontext}\) be the expression semantics of 
	\(\anexpr\) in the context \(\acontext\).  The expression semantics
	is external to this semantics, but is largely that of Z.
\end{itemize}

\section{\tockcsp{} semantics}\label{sec:semantics-tockcsp}
\input{semantics/tockcsp}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "robocert"
%%% End:
